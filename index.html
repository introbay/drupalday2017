<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

	<head>
		<meta charset="utf-8">

		<title>INTROBAY - Docker & Drupal</title>

		<meta name="description" content="Docker & Drupal">
		<meta name="author" content="Ignacio López Flores - Javier Gómez Gómez">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/introbay.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>



		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<style type="text/css">
            .reveal section img.sin-cajas {
                border:none; 
                width:85px ;
                background: none;
                box-shadow: none;
            }
        </style>

        <!-- Slides  content to be added here -->

        <div class="reveal">
            <div class="slides">

                <section>
                    <img src="imgs/logo-tag-centro-blanco.svg" style="width: 30%;box-shadow: none;border: none;">
                    <img src="imgs/logocaceres.png" style="width: 11%;box-shadow: none;border: none;margin-left: 10%">
                    <div>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</div>
                    <br>
                    <div style="float: left; margin-bottom: 20px;">
                        <img src="imgs/Logo-Docker.svg" style="width: 44%;box-shadow: none;border: none;float: left">
                        <span class="ampersand">&</span>
                        <img src="imgs/drupal_logo-blue.png" style="width: 30%;box-shadow: none;border: none;float: left">
                    </div>
                    <h3>Taller de Docker & Drupal</h3>
                </section>
                <section>
                    <h2>¿Quién soy?</h2>
                    <img align="left" src="imgs/sobre-nosotros/ignacio.png" width="250" border="none">
                    <div style="float: right;" class="ficha">
                      <p>Ignacio L&oacute;pez Flores</p>
                      <p>Founder & CEO @ Introbay</p>
                      <a href="https://twitter.com/ignaciolflores" target="_blank">@ignaciolflores</a>
                      <p>IRC: ignaciolflores</p>
                    </div>
                </section>
                <section>
                    <section>
                        <h2>La matriz del infierno</h2>
                        <img class="sin-cajas" style="width:800px" src="imgs/the-matrix-from-hell.png">
                    </section>
                    <section>
                        <h2>Conceptos básicos</h2>
                        <ul>
                            <li><span class="resaltado">Virtualización: </span>Creación por software de la versión virtual de un recurso tecnológico, habitualmente servidores.</li>
                            <li><span class="resaltado">Maquina virtual (VM): </span>Emulación de una ordenador físico por medio de software en un sistema anfitrión.</li>
                            <li><span class="resaltado">Hipervisor: </span>Sistema anfitrión sobre el que funcionan las VM, puede ser por software ó hardware (poco habituales).</li>
                            <ul>
                                <li><span class="resaltado">Escritorio: </span>virtualbox, vmware, etc.</li>
                                <li><span class="resaltado">Servidor: </span>xenserver, proxmox, etc.</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>Linux Containers (LCX)</h2>
                        <!--<img class="sin-cajas" style="width:600px" src="imgs/Linux-containers.jpg">-->
                        <ul>
                            <li>Permite que un servidor físico ejecute <span class="resaltado">múltiples instancias</span> de sistemas operativos aislados compartiendo el core.</li>
                            <li>Pueden tener diferentes Sistemas Operativos (debian, centos, redhat, ubuntu, etc.) siempre que tengan la <span class="resaltado">misma versión del core</span> que el sistema anfitrión.</li>
                            <li>Consumen <span class="resaltado">menos recursos</span> hardware y software que las VM.</li>
                            <li>Implementación basada en <span class="resaltado">imágenes</span>.</li>
                            <li><span class="resaltado">Aislamiento de aplicaciones</span> que se pueden combinar.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Y llegó Docker y su Dockerfile</h2>
                        <ul>
                            <li>Docker define un formato para <span class="resaltado">empaquetar una aplicación</span> y todas sus <span class="resaltado">dependencias</span> en un solo objeto que pueden ser transferidas a cualquier otro sistema Docker, y ser ejecutados allí con la garantía de que el entorno de ejecución será <span class="resaltado">siempre el mismo.</span></li>
                            <li><strong>Contenedores:</strong> contienen todo lo necesario para que una aplicación pueda funcionar.</li>
                            <li><strong>Imágenes:</strong> sistema operativo con aplicaciones instaladas y configuradas.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Estructura de Docker</h2>
                        <img class="sin-cajas" style="width:800px" src="imgs/docker_engine_overview_image_0.png">
                    </section>
                    <section>
                        <h2>La solución de Docker</h2>
                        <img class="sin-cajas" style="width:900px" src="imgs/Screen_Shot_2014-10-27_at_11.24.59_PM.png">
                    </section>
                    <section>
                        <h2>Docker Registry</h2>
                        <ul>
                            <li><span class="resaltado">Registry: </span>Servidor que contiene repositorios e imágenes.</li>
                            <li><span class="resaltado">Repositorios: </span>Contiene imagenes creadas y listas para ser descargadas.</li>
                            <li>Repositorio oficial <span class="resaltado">
                                <a target="_blank" href="https://hub.docker.com/">https://hub.docker.com</a>
                            <li>En <span class="resaltado">Dockerhub</span> podemos crear repositorios privados ó públicos.</li>
                            <li>Dockerhub se integra con repositorios de código como <span class="resaltado">GitHub</span> y construye las imagenes al actualizarlos.</li>
                            <li>También podemos tener nuestro propio Registry que se crea a partir de una imagen Docker.</li>
                        </ul>
                        <!--<img class="sin-cajas" style="width:600px" src="imgs/docker-structure.jpg">-->
                    </section>
                </section>
                <section>
                    <h2>Instalación de Docker</h2>
                    <ul>
                        <li>
                            <code>https://docs.docker.com/engine/installation</code>
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>Windows y  Mac OSX</h2>

                    <ul>
                        <li>Necesitamos un hipervisor como <strong>Virtualbox</strong></li>
                        <li>Windows 7 ó superior <a target="_blank" href="https://docs.docker.com/docker-for-windows/install/">https://docs.docker.com/docker-for-windows/install/</a></span></li>
                        <li>Mac OSX 10.8 ó superior <a target="_blank" href="https://docs.docker.com/docker-for-mac/install/">https://docs.docker.com/docker-for-mac/install/</a></span></li>
                    </ul>
                </section>
                <section>
                    <h2>Cómo funciona?</h2>
                    <ul>
                        <li>Descargamos una imagen base de un repositorio. <br/>
                            <span class="resaltado">docker pull</span></li>
                        <li>A partir de la imagen base creamos nuestro contenedor. <br/>
                            <span class="resaltado">docker run</span></li>
                        <li>Realizamos los cambios que deseamos sobre el contenedor.</li>
                        <li>Creamos nuestra imagen personalizada<br/>
                            <span class="resaltado">docker commit</span></li>
                        <li>Subimos la imagen a un repositorio (público ó privado).  <br/>
                            <span class="resaltado">docker push</span></li>
                        <li>Reutilizamos nuestra imagen docker como base para nuevos contenedores.</li>
                    </ul>
                </section>
                <section data-markdown>
                    ##Linea de comandos

                    <strong>Sintaxis:</strong><br/>
                    <code>docker [OPTIONS] COMMAND [argumentos]</code><br/>
                    <br/>
                    ### Ejemplos:

                    ```
                    docker pull drupal:8
                    docker run -it drupal:8 bash
                    docker ps -a
                    docker start *musing_turing*
                    docker exec -it *musing_turing* bash
                    docker ps -a
                    docker stop *musing_turing*
                    docker rm *musing_turing*
                    ```
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Ejemplos

                        ```
                        $ docker pull drupal:8
                        $ docker run -d --name test drupal:8
                        ```
                        Entramos en el contenedor
                        ```
                        docker exec -it test bash
                        ```
                        Una vez dentro, instalamos drush
                        ```
                        curl -sS https://getcomposer.org/installer | php
                        mv composer.phar /usr/local/bin/composer

                        composer global require drush/drush:8.*

                        export PATH="$HOME/.composer/vendor/bin:$PATH"

                        echo export PATH=\"$HOME/.composer/vendor/bin:$PATH\" >> /root/.bashrc
                        ```
                    </script>
                </section>
                <section>
                    <h2>Vamos a crear nuestra propia imagen</h2>
                    Ventajas
                    <ul>
                        <li>Evitamos tener que ejecutar el mismo código cada vez</li>
                        <li>Podemos distribuir nuestra configuración</li>
                        <li>Podemos abstraer a los desarrolladores de aspectos de DevOps</li>
                        <li>Otras que se me irán ocurriendo durante este taller...</li>
                    </ul>
                </section>
                <section data-markdown>
                    ## Vamos a crear nuestra propia imagen

                    Dockerfile
                    ```
                    FROM drupal:8

                    # Install drush by using composer
                    ENV COMPOSER_HOME /root/composer
                    ENV COMPOSER_VERSION master

                    RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \
                        && composer global require drush/drush:8.* \
                        && ln -sf $COMPOSER_HOME/vendor/bin/drush.php /usr/local/bin/drush \
                        && drush cache-clear drush

                    ```
                </section>
                <section data-markdown>
                    ## Vamos a crear nuestra propia imagen

                    ```
                    docker build -t midrupal .
                    ```
                </section>
                <section data-markdown>
                    ## Vamos a usar nuestra propia imagen

                    ```
                    $ docker run -it --rm midrupal bash
                    $ drush --version
                    $ drush dl pathauto
                    ```

                    Ahora podemos usar drush al lanzar un contenedor sin tener que instalarlo cada vez

                </section>

                <section>
                    <h2>Docker-compose</h2>

                    <span class="resaltado">Constructor de aplicaciones multi-contenedor</span><br/>
                    <strong>Qué necesitamos:</strong><br/>

                    <ul>
                        <li>Carpeta del proyecto.</li>
                        <li>fichero <span class="resaltado">docker-compose.yml</span>.</li>
                        <li>levantar todo: <span class="resaltado">docker compose up</span></li>
                    </ul>
                    <p>
                        <strong>qué contiene <span class="resaltado">docker-compose.yml</span>?</strong>
                    </p>
                    <ul>
                        <li>descriptor de los contenedores.</li>
                        <li>formato de serialización <span class="resaltado">yaml</span>.</li>
                        <li>especificamos: contenedores, propiedades, variables de entorno, etc</li>
                    </ul>

                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## docker-compose

                        ```
                        version: '3'
                        services:
                           app:
                              image: midrupal
                              ports:
                               - 8080:80
                              networks:
                               - frontend
                              depends_on:
                               - db
                           db:
                              image: mysql:5.6
                              environment:
                                - MYSQL_ROOT_PASSWORD=1234
                                - MYSQL_DATABASE=database
                                - MYSQL_USER=user
                                - MYSQL_PASSWORD=1234
                              networks:
                               - frontend
                        networks:
                           frontend:

                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## docker-compose

                        Creamos los contenedores

                        ```
                        $ docker-compose up -d
                        ```
                        Comprobamos que todo está en ejecución
                        ```
                        $ docker-compose ps

                        $ docker ps -a
                        ```

                        Entrar en un contenedor de nuestro stack
                        ```
                        $ docker-compose exec app bash
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Usándo nuestro propio drupal

                        `Dockerfile`

                        ```
                        FROM introbay/php-dev:7.0-apache

                        COPY ./drupal /var/www/html

                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Usándo nuestro propio drupal

                        `docker-compose.yml`

                        ```
                        version: '3'
                        services:
                           app:
                              build: ./app/
                              ports:
                               - 8080:80
                              networks:
                               - frontend
                              depends_on:
                               - db
                           db:
                              image: mysql:5.6
                              env_file:
                               - ./mysql.env
                              networks:
                               - frontend
                              volumes:
                               - ./db:/var/lib/mysql
                        networks:
                           frontend:
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Usándo nuestro propio drupal

                        Construimos los contenedores

                        ```
                        $ docker-compose build

                        $ docker images
                        ```

                        Creamos los contenedores

                        ```
                        $ docker-compose up -d
                        ```
                        Comprobamos que todo está en ejecución
                        ```
                        $ docker-compose ps
                        ```
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Accediendo al código

                        Añadimos un contenedor SSH

                        ```
                        version: '3'
                        services:
                           app:
                              build: ./app/
                              ports:
                               - 8080:80
                              volumes:
                               - codevolume:/var/www/html
                              networks:
                               - frontend
                              depends_on:
                               - db
                           db:
                              image: mysql:5.6
                              env_file:
                               - ./mysql.env
                              networks:
                               - frontend
                              volumes:
                               - ./db:/var/lib/mysql
                           ssh:
                              image: introbay/docker-drupal-ssh:latest
                              volumes:
                               - $HOME/.ssh/id_rsa:/root/.ssh/id_rsa # deben estar creados
                               - $HOME/.ssh/id_rsa.pub:/root/.ssh/id_rsa.pub
                               - $HOME/.ssh/known_hosts:/root/.ssh/known_hosts
                               - ~/.gitconfig:/root/.gitconfig
                              volumes:
                               - codevolume:/var/www/html
                              ports:
                               - 22
                              networks:
                               - frontend
                              environment:
                               - SSH_PASS=hola
                        networks:
                           frontend:
                        volumes:
                            codevolume:
                        ```
                    </script>
                </section>


                <section data-markdown>
                    <script type="text/template">
                        ## Accediendo al código

                        Montamos una unidad a través de SSH

                        ```
                        sshfs www-data@localhost:/var/www/html /var/dockers/remote -p 32768
                        ```
                    </script>
                </section>

                <section>
                    <h2>Aplicaciones prácticas</h2>
                    <p>Dependiendo de tu perfil:</p>
                    <ul>
                        <li>DevOps</li>
                        <li>Desarrollador (back o front)</li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <p>Es posible tener diferentes configuraciones dependiendo del entorno</p>
                    <ul>
                        <li>
                            Prod: Mínima configuración, foco en <strong>performance</strong>.
                        </li>
                        <li>
                            Pre-prod: Basado en la configuración de Prod. Se usa habitualmente para construir el entorno de integración.
                        </li>
                        <li>
                            Dev: Basado en Pre-prod, puede añadir herramientas útiles en desarrollo: xdebug, vim, sass compiler, etc.
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <p>Otras cosas que hacen la vida más fácil:</p>
                    <ul>
                        <li>
                            Distribución de imágenes cocinadas listas para usar en cada entorno.
                        </li>
                        <li>
                            Sistemas de integración continua.
                        </li>
                        <li>
                            Control de versiones sobre la configuración.
                        </li>
                        <li>
                            Eliminación del efecto “a mi me funciona”.
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>DevOps</h2>
                    <h3>Despliegues</h3>
                    <ul>
                        <li>
                            Las imágenes de nuestra aplicación son los <em>artifacts</em> que desplegamos
                        </li>
                        <li>
                            Worflow simple: generas una imagen, despliegas, post-scripts
                        </li>
                        <li>
                            Desplegar o actualizar una imagen nueva es simple y rápido:<br/>
                            docker-compose up -d
                        </li>
                        <li>
                            Gestionar actualizaciones y cambios de versión pasa por <em>construir la nueva imagen</em>
                            y cambiar un número en el docker-compose.yml
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>Dev (back & front)</h2>
                    <ul>
                        <li>Simplificación del workflow de trabajo.</li>
                        <li>Posibilidad de tener múltiples entornos en la misma máquina.</li>
                        <li>Cambiar entre proyectos es fácil.</li>
                        <li>Desarrollo y tests sobre entorno idéntico a producción.</li>
                        <li>No queremos saber nada de sistemas!</li>
                    </ul>
                </section>
                <section>
                    <h2>Dev (back & front)</h2>
                    <h3>¿Cómo modifico mi código?</h3>
                    <p>Hay varias opciones.</p>
                    <ul>
                        <li>Entro en el contenedor, uso Vim, git, etc.</li>
                        <li>Mapeo el directorio donde está mi código y lo modifico desde el exterior. (=> permisos :-S).</li>
                        <li>Nuestra solución: contenedor extra con SSH y que usa el volumen de Drupal (sshfs).</li>
                    </ul>
                </section>

                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>No confies en alguien que te diga que Docker es un camino de rosas.</p>
                </section>
                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Empieza desde abajo, déjate el balconing.</p>
                </section>

                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Hay más dockers en el mar.</p>
                    <p>Google, CoreOs, RancherOs, ...</p>
                </section>
                <section>
                    <h2>A tener en cuenta...</h2>
                    <p>Cuidado con los trendy guys.</p>
                </section>

                <section>
                    <h1>¿Preguntas?</h1>
                </section>

                <section>
                    <img src="imgs/logo-tag-centro-blanco.svg" style="width: 30%;box-shadow: none;border: none;">
                    <img src="imgs/logocaceres.png" style="width: 11%;box-shadow: none;border: none;margin-left: 10%">
                    <div>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</div>
                    <br>
                    <h1>Gracias</h1>

                    <div>Ignacio López Flores</div>
                </section>


            </div>
        </div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: 'slide', // none/fade/slide/convex/concave/zoom


                // Parallax background image
                // parallaxBackgroundImage: 'imgs/bgdrupal.jpg', 
                // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

                // Parallax background size
                // parallaxBackgroundSize: '1920px 1080px', // CSS syntax, e.g. "2100px 900px"

                // Amount to move parallax background (horizontal and vertical) on slide change
                // Number, e.g. 100
                //parallaxBackgroundHorizontal: '',
                //parallaxBackgroundVertical: '',

                math: {
                    mathjax: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js',
                    config: 'TeX-AMS_HTML-full' // See http://docs.mathjax.org/en/latest/config-files.html
                },
                // Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
				],
                keyboard: {
                  39: 'next',
                  37: 'prev',
                  27: 'next'
                }
			});

		</script>

	</body>
</html>